<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Missing data lecture 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-fd68462179fdb1eb8400a3e2e38edf1e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
window.MathJax = {
  startup: {
    ready() {
      MathJax.startup.defaultReady();
      const {STATE} = MathJax._.core.MathItem;
      MathJax.tex2mml(String.raw`
      \newcommand{\R}{\mathbb{R}}
      \newcommand{\comp}{\mathsf{c}}
        \newcommand{\lp}{\left(}
        \newcommand{\rp}{\right)}
        \newcommand{\lb}{\left[}
        \newcommand{\rb}{\right]}
        \newcommand{\ind}[1]{\mathbbm{1}\lp#1\rp}
        \newcommand{\Exp}[1]{\mathbb{E} \lb #1 \rb}
        \newcommand{\ExpA}[2]{\mathbb{E}_{#2} \lb #1 \rb}
        \newcommand{\indy}{\mathrel{\unicode{x2AEB}}}
        \newcommand{\Prob}[2]{\mathbb{P}_{#2} \lp #1 \rp}
        \newcommand{\abs}[1]{\left| #1 \right|}
      `);
    }
  },
  loader: {load: ['[tex]/bbm']},
  tex: {packages: {'[+]': ['bbm']}}
};
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@4.1/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../papers.html"> 
<span class="menu-text">My papers</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Random thoughts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../courses.html"> 
<span class="menu-text">Courses</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#recap" id="toc-recap" class="nav-link active" data-scroll-target="#recap">Recap</a>
  <ul class="collapse">
  <li><a href="#missingness-mechanisms" id="toc-missingness-mechanisms" class="nav-link" data-scroll-target="#missingness-mechanisms">Missingness mechanisms</a>
  <ul class="collapse">
  <li><a href="#missing-completely-at-random-mcar" id="toc-missing-completely-at-random-mcar" class="nav-link" data-scroll-target="#missing-completely-at-random-mcar">Missing completely at random (MCAR)</a></li>
  <li><a href="#missing-at-random-mar" id="toc-missing-at-random-mar" class="nav-link" data-scroll-target="#missing-at-random-mar">Missing at random (MAR)</a></li>
  </ul></li>
  <li><a href="#univariate-mar-data" id="toc-univariate-mar-data" class="nav-link" data-scroll-target="#univariate-mar-data">Univariate MAR data</a></li>
  <li><a href="#continuing-with-our-example-from-last-lecture" id="toc-continuing-with-our-example-from-last-lecture" class="nav-link" data-scroll-target="#continuing-with-our-example-from-last-lecture">Continuing with our example from last lecture</a>
  <ul class="collapse">
  <li><a href="#generalizing-the-example" id="toc-generalizing-the-example" class="nav-link" data-scroll-target="#generalizing-the-example">Generalizing the example</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#missing-not-at-random-mnar" id="toc-missing-not-at-random-mnar" class="nav-link" data-scroll-target="#missing-not-at-random-mnar">Missing-not-at-random (MNAR)</a></li>
  <li><a href="#complete-case-analysis" id="toc-complete-case-analysis" class="nav-link" data-scroll-target="#complete-case-analysis">Complete case analysis</a>
  <ul class="collapse">
  <li><a href="#bias-of-cca" id="toc-bias-of-cca" class="nav-link" data-scroll-target="#bias-of-cca">Bias of CCA</a></li>
  </ul></li>
  <li><a href="#weighting-estimators" id="toc-weighting-estimators" class="nav-link" data-scroll-target="#weighting-estimators">Weighting estimators</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Missing data lecture 2</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Notation</th>
<th>Meaning</th>
<th>Domain</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(Y\)</span></td>
<td><span class="math inline">\(n\times K\)</span> matrix, collection of measurements of interest</td>
<td><span class="math inline">\(\R^{n \times K}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\tilde{y}\)</span></td>
<td>Realization of <span class="math inline">\(Y\)</span></td>
<td><span class="math inline">\(\R^{n \times K}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(Y_{ij}\)</span></td>
<td>Element of <span class="math inline">\(Y\)</span>, random variables</td>
<td><span class="math inline">\(\R\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\tilde{y}_{ij}\)</span></td>
<td>Particular realization of <span class="math inline">\(Y_{ij}\)</span></td>
<td><span class="math inline">\(\R\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(Y_{i}\)</span></td>
<td><span class="math inline">\(i^\mathrm{th}\)</span> row of <span class="math inline">\(Y\)</span>, random variables</td>
<td><span class="math inline">\(\R^K\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\tilde{y}_{i}\)</span></td>
<td>Particular realization of <span class="math inline">\(Y_{i}\)</span></td>
<td><span class="math inline">\(\R^K\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(y_{i}\)</span></td>
<td>Arbitrary element of <span class="math inline">\(\R^K\)</span>, for use in density functions related to <span class="math inline">\(Y_i\)</span></td>
<td><span class="math inline">\(\R^K\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(M\)</span></td>
<td><span class="math inline">\(n\times K\)</span> binary matrix of missingness indicators</td>
<td><span class="math inline">\(\{0,1\}^{n \times K}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\tilde{m}\)</span></td>
<td>Realization of <span class="math inline">\(M\)</span></td>
<td><span class="math inline">\(\{0,1\}^{n \times K}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(M_{ij}\)</span></td>
<td>Element of <span class="math inline">\(M\)</span>, random variable</td>
<td><span class="math inline">\(\{0,1\}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(M_{i}\)</span></td>
<td><span class="math inline">\(i^\mathrm{th}\)</span> row of <span class="math inline">\(M\)</span>, random variables</td>
<td><span class="math inline">\(\{0,1\}^{K}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\tilde{m}_{ij}\)</span></td>
<td>Realization of <span class="math inline">\(M_{ij}\)</span></td>
<td><span class="math inline">\(\{0,1\}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\tilde{m}_{i}\)</span></td>
<td>Realization of <span class="math inline">\(M_{i}\)</span></td>
<td><span class="math inline">\(\{0,1\}^K\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(m_{i}\)</span></td>
<td>Arbitrary element of <span class="math inline">\(\{0,1\}^K\)</span> for use in PMFs for <span class="math inline">\(M_i\)</span></td>
<td><span class="math inline">\(\{0,1\}^K\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(R_i\)</span></td>
<td>Number of observed values for row <span class="math inline">\(i\)</span> in <span class="math inline">\(Y\)</span>, <span class="math inline">\(\sum_{j=1}^K (1 - M_{ij})\)</span></td>
<td><span class="math inline">\(\mathbb{N}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(Y_{(0)i}\)</span></td>
<td>Observed elements of <span class="math inline">\(Y_i\)</span></td>
<td><span class="math inline">\(\R^{R_i}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\tilde{y}_{(0)i}\)</span></td>
<td>Realization of <span class="math inline">\(Y_{(0)i}\)</span></td>
<td><span class="math inline">\(\R^{R_i}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(y_{(0)i}\)</span></td>
<td>Arbitrary element of <span class="math inline">\(\R^{R_i}\)</span></td>
<td><span class="math inline">\(\R^{R_i}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(Y_{(1)i}\)</span></td>
<td>Unobserved or missing elements of <span class="math inline">\(Y_i\)</span></td>
<td><span class="math inline">\(\R^{K - R_i}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\tilde{y}_{(1)i}\)</span></td>
<td>Realization of <span class="math inline">\(Y_{(1)i}\)</span></td>
<td><span class="math inline">\(\R^{K - R_i}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(y_{(1)i}, y^\star_{(1)i}\)</span></td>
<td>Arbitrary elements of <span class="math inline">\(\R^{K - R_i}\)</span></td>
<td><span class="math inline">\(\R^{K - R_i}\)</span></td>
</tr>
</tbody>
</table>
<section id="recap" class="level1">
<h1>Recap</h1>
<section id="missingness-mechanisms" class="level2">
<h2 class="anchored" data-anchor-id="missingness-mechanisms">Missingness mechanisms</h2>
<p>Mechanisms relate to the distribution: <span class="math display">\[
f_{M_i \mid Y_i}(M_i = \tilde{m}_i \mid Y_i = y_i, \phi),
\]</span> where <span class="math inline">\(\phi\)</span> are the parameters that govern the missingness mechanism.</p>
<section id="missing-completely-at-random-mcar" class="level3">
<h3 class="anchored" data-anchor-id="missing-completely-at-random-mcar">Missing completely at random (MCAR)</h3>
<p>Data are said to be <strong>MCAR</strong> if the following holds for all <span class="math inline">\(i\)</span>, <span class="math inline">\(y_i\)</span>, <span class="math inline">\(y^\star_i\)</span>, and <span class="math inline">\(\phi\)</span>: <span class="math display">\[
f_{M_i\mid Y_i}(M_i = \tilde{m}_i \mid Y_i = y_i, \phi) = f_{M\mid Y}(M_i = \tilde{m}_i \mid Y_i = y^\star_i, \phi).
\]</span></p>
</section>
<section id="missing-at-random-mar" class="level3">
<h3 class="anchored" data-anchor-id="missing-at-random-mar">Missing at random (MAR)</h3>
<p>Missing at random data are characterized by the following equality for all <span class="math inline">\(i\)</span>, <span class="math inline">\(y_{(1)i}\)</span>, <span class="math inline">\(y^\star_{(1)i}\)</span>, and <span class="math inline">\(\phi\)</span>: <span class="math display">\[
f_{M_i\mid Y_i}(M_i = \tilde{m}_i \mid Y_{(0)i} = \tilde{y}_{(0)i}, Y_{(1)i} = y_{(1)i}, \phi) = f_{M_i\mid Y_i}(M_i = \tilde{m}_i \mid Y_{(0)i} = \tilde{y}_{(0)i}, Y_{(1)i} = y^\star_{(1)i}, \phi)  
\]</span></p>
</section>
</section>
<section id="univariate-mar-data" class="level2">
<h2 class="anchored" data-anchor-id="univariate-mar-data">Univariate MAR data</h2>
<p>Univariate MAR data is useful to consider because it elucidates a key assumption that can be used in MAR analyses.</p>
<p>Suppose we have a single measurement on <span class="math inline">\(n\)</span> individuals, <span class="math inline">\(Y_i\)</span> and <span class="math inline">\(r\)</span> of the individuals in our sample have observations <span class="math inline">\(\tilde{y}_i\)</span> while <span class="math inline">\(n-r\)</span> individuals have missing values for <span class="math inline">\(Y_i\)</span> (i.e.&nbsp;<span class="math inline">\(\tilde{y}_{(1)i} = \tilde{y}_{i}\)</span>, <span class="math inline">\(\tilde{y}_{(0)i} = \emptyset\)</span>). Suppose we also have iid measurements and an iid missingness process.</p>
<p>Writing out the missingness mechanism for this scenario gives us: <span class="math display">\[
\begin{aligned}
f_{M_i\mid Y_i}(M_i = \tilde{m}_i \mid Y_{(0)i} = \tilde{y}_{(0)i}, Y_{(1)i} = y_{(1)i}, \phi) &amp; = f_{M_i\mid Y_i}(M_i = \tilde{m}_i \mid Y_{(0)i} = \tilde{y}_{(0)i}, Y_{(1)i} = y^\star_{(1)i}, \phi) \\
&amp; = f_{M_i\mid Y_i}(M_i = \tilde{m}_i \mid \phi)  
\end{aligned}
\]</span> This implies something about the relationship between the units the have observed data and those that do not: <span class="math display">\[
\begin{aligned}
f_{Y_i \mid M_i}(Y_{i} = y_{i} \mid M_i = \tilde{m}_i, \theta) &amp; = \frac{f_{M_i\mid Y_i}(M_i = \tilde{m}_i \mid Y_{i} = y_i, \phi) f_{Y_i}(Y_i = y_i \mid \theta)}{f_{M_i\mid Y_i}(M_i = \tilde{m}_i \mid \phi)} \\
&amp; = f_{Y_i}(Y_i = y_i \mid \theta)
\end{aligned}
\]</span> This implies that <span class="math display">\[
\begin{aligned}
f_{Y_i \mid M_i}(Y_{i} = y_{i} \mid M_i = 1, \theta) &amp; = f_{Y_i \mid M_i}(Y_{i} = y_{i} \mid M_i = 0, \theta)
\end{aligned}
\]</span> Thus, we can use the distribution we learn from the complete cases as the distribution for the cases that are missing. This idea holds for more general missingness patterns with more measurements. We’ll see this later in the course.</p>
</section>
<section id="continuing-with-our-example-from-last-lecture" class="level2">
<h2 class="anchored" data-anchor-id="continuing-with-our-example-from-last-lecture">Continuing with our example from last lecture</h2>
<p>The following example is adapted from <span class="citation" data-cites="mealliClarifyingMissingRandom2015">Mealli and Rubin (<a href="#ref-mealliClarifyingMissingRandom2015" role="doc-biblioref">2015</a>)</span>: Suppose we’re analyzing data from that Crohn’s disease trial and <span class="math inline">\(Y_i\)</span> has two components: <span class="math inline">\(Y_{i1}\)</span> is CDAI at visit 1 and <span class="math inline">\(Y_{i2}\)</span> is CDAI at visit 2. For patient <span class="math inline">\(i\)</span> suppose that <span class="math inline">\(m_i = (0, 1)\)</span>, or that <span class="math inline">\(Y_{i2}\)</span> is missing but <span class="math inline">\(Y_{i1}\)</span> is observed.</p>
<p>Bringing this example into line with our previous notation, <span class="math inline">\(Y_{(0)i} \equiv Y_{i1}\)</span> and <span class="math inline">\(Y_{(1)i} \equiv Y_{i2}\)</span>. Then <span class="math inline">\(\tilde{y}_{(0)i} \equiv \tilde{y}_{i1}\)</span>.</p>
<p>Consider two scenarios:</p>
<ol type="1">
<li><p><span class="math inline">\(Y_{i2}\)</span> is missing because <span class="math inline">\(Y_{i1} &gt; \phi\)</span>. Given that <span class="math inline">\(0^0 = 1\)</span>, in this scenario the missingness mechanism can be translated as: <span class="math display">\[
f_{M_{i2}\mid Y_i}(M_{i2} = m_{i2} \mid Y_{(0)i} = \tilde{y}_{(0)i}, Y_{(1)i} = y_{(1)i}, \phi) = \ind{\tilde{y}_{(0)i} &gt; \phi}^{m_{i2}}(1 - \ind{\tilde{y}_{(0)i} &gt; \phi})^{1 - m_{i2}}
\]</span></p></li>
<li><p><span class="math inline">\(Y_{i2}\)</span> is missing because <span class="math inline">\(Y_{i2} &gt; \phi\)</span>. This mechanism is translated as <span class="math display">\[
f_{M_{i2}\mid Y_i}(M_{i2} = m_{i2} \mid Y_{(0)i} = \tilde{y}_{(0)i}, Y_{(1)i} = y_{(1)i}, \phi) = \ind{y_{(1)i} &gt; \phi}^{m_{i2}}(1 - \ind{y_{(1)i} &gt; \phi})^{1 - m_{i2}}
\]</span> In scenario 1 the data are MAR because the mass function is a function of <span class="math inline">\(\tilde{y}_{(0)i}\)</span> only, (i.e it depends only on <span class="math inline">\(Y_{i1}\)</span>), while in scenario 2 the data do not satisfy the definition of MAR.</p></li>
</ol>
<section id="generalizing-the-example" class="level3">
<h3 class="anchored" data-anchor-id="generalizing-the-example">Generalizing the example</h3>
<p>Let’s make this example more general. The following is from <span class="citation" data-cites="little2019statistical">Little and Rubin (<a href="#ref-little2019statistical" role="doc-biblioref">2019, 23</a>)</span>. Again consider the bivariate case with <span class="math inline">\(y_{i1}, y_{i2}\)</span>. There are 4 possible missing data patterns: <span class="math display">\[
(m_{i1}, m_{i2}) \in \{(0,0), (0,1), (1,0), (1,1)\}
\]</span> We’ll need to define <span class="math inline">\(f_{M \mid Y}(m_{i1} = r, m_{i2} = s \mid y_{i1}, y_{i2}, \phi)\)</span>. To simplify the notation, let <span class="math display">\[
g_{rs}(y_{i1}, y_{i2}, \phi) = f_{M \mid Y}(m_{i1} = r, m_{i2} = s \mid y_{i1}, y_{i2}, \phi)
\]</span> The MAR assumption implies the following: <span class="math display">\[
\begin{aligned}
g_{11}(y_{i1}, y_{i2}, \phi) &amp; = g_{11}(\phi) \\
g_{01}(y_{i1}, y_{i2}, \phi) &amp; = g_{01}(y_{i1}, \phi) \\
g_{10}(y_{i1}, y_{i2}, \phi) &amp; = g_{10}(y_{i2}, \phi) \\
g_{00}(y_{i1}, y_{i2}, \phi) &amp; = 1 - g_{10}(y_{i2}, \phi)  - g_{01}(y_{i1}, \phi) -  g_{11}(\phi)
\end{aligned}
\]</span> Thus the probability that <span class="math inline">\(y_{ij}\)</span> is missing can depend only on <span class="math inline">\(y_{i(-j)}\)</span>, which is a bit odd.</p>
<p><span class="citation" data-cites="little2019statistical">Little and Rubin (<a href="#ref-little2019statistical" role="doc-biblioref">2019</a>)</span> proposes the following modification:</p>
<p><span class="math display">\[
\begin{aligned}
g_{11}(y_{i1}, y_{i2}, \phi) &amp; = g_{1+}(y_{i1}, \phi)g_{+1}(y_{i2}, \phi) \\
g_{01}(y_{i1}, y_{i2}, \phi) &amp; = (1 - g_{1+}(y_{i1}, \phi))g_{+1}(y_{i2}, \phi) \\
g_{10}(y_{i1}, y_{i2}, \phi) &amp; = g_{1+}(y_{i1}, \phi)(1 - g_{+1}(y_{i2}, \phi)) \\
g_{00}(y_{i1}, y_{i2}, \phi) &amp; = (1 - g_{1+}(y_{i1}, \phi))(1 - g_{+1}(y_{i2}, \phi))
\end{aligned}
\]</span> While this is maybe more realistic, though it does make an assumption that <span class="math inline">\(m_{i1}\)</span> and <span class="math inline">\(m_{i2}\)</span> are conditionally independent given <span class="math inline">\(y_{i1}, y_{i2}\)</span>, it is also hard to estimate, because we won’t observe missing values of <span class="math inline">\(y_{i1}\)</span> and <span class="math inline">\(y_{i2}\)</span>.</p>
<p>This is a scenario called missing-not-at-random, or MNAR. This is defined in the next subsection.</p>
</section>
</section>
</section>
<section id="missing-not-at-random-mnar" class="level1">
<h1>Missing-not-at-random (MNAR)</h1>
<p>MNAR data is characterized by the following relationship:</p>
<p><span class="math display">\[
f_{M_i\mid Y_i}(M_i = \tilde{m}_i \mid Y_{(0)i} = \tilde{y}_{(0)i},Y_{(1)i} =  y_{(1)i}, \phi) \neq f_{M_i\mid Y_i}(M_i = \tilde{m}_i \mid Y_{(0)i} = \tilde{y}_{(0)i},Y_{(1)i} =  y^\star_{(1)i}, \phi)
\]</span> for some <span class="math inline">\(\phi\)</span> and <span class="math inline">\(y_{(1)i} \neq y^\star_{(1)i}\)</span> <span class="citation" data-cites="mealliClarifyingMissingRandom2015">(<a href="#ref-mealliClarifyingMissingRandom2015" role="doc-biblioref">Mealli and Rubin 2015</a>)</span>.</p>
<p>The version using conditional dependence is called missing not always at random, or MNAAR, which is</p>
<p><span class="math display">\[
f_{M_i\mid Y_i}(M_i = m_i \mid Y_{(0)i} = y_{(0)i},Y_{(1)i} =  y_{(1)i}, \phi) \neq f_{M_i\mid Y_i}(M_i = m_i \mid Y_{(0)i} = y_{(0)i},Y_{(1)i} =  y^\star_{(1)i}, \phi)
\]</span></p>
<p>for some <span class="math inline">\(\phi, m_i, y_{(0)i}\)</span> and <span class="math inline">\(y_{(1)i} \neq y^\star_{(1)i}\)</span><span class="citation" data-cites="mealliClarifyingMissingRandom2015">(<a href="#ref-mealliClarifyingMissingRandom2015" role="doc-biblioref">Mealli and Rubin 2015</a>)</span>.</p>
<p>Our textbook mentions that sometimes MAR can yield better results than MNAR, citing <span class="citation" data-cites="rubin1995handling">Rubin, Stern, and Vehovar (<a href="#ref-rubin1995handling" role="doc-biblioref">1995</a>)</span>. This is something we’ll explore later on in the course, namely how we would determine whether it was worth it to fit an MNAR model vs.&nbsp;a MAR model. Not surpisingly, like most things in statistics, the answer is “It depends.”</p>
</section>
<section id="complete-case-analysis" class="level1">
<h1>Complete case analysis</h1>
<p>The most common approach to missing data analysis is complete case analysis, or <strong>CCA</strong>. Given the matrix <span class="math inline">\(M\)</span> and its realization <span class="math inline">\(\tilde{m}\)</span>, the complete cases are those rows <span class="math inline">\(i\)</span> such that <span class="math inline">\(\sum_{j=1}^K \tilde{m}_{ij} = 0\)</span>. Let these indices be denoted <span class="math inline">\(\mathcal{R} = \{i \mid \sum_{j=1}^K \tilde{m}_{ij} = 0, i = 1, \dots, n\}\)</span>. Let the size of this set be <span class="math inline">\(r = \abs{\mathcal{R}}\)</span>.</p>
<p>Complete case analysis is, in general, only valid when the missingness mechanism is MCAR, though depending on what your estimand of interest is, there can be exceptions for MAR and even MNAR missingness<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>The first issue with complete case analysis is that, even if your estimator is unbiased, your estimator will not be efficient. A simple example demostrates the problem.</p>
<p>Suppose we have two measurements of interest, <span class="math inline">\(Y_{i1}\)</span> and <span class="math inline">\(Y_{i2}\)</span> for <span class="math inline">\(n\)</span> individuals and that they are jointly multivariate normal: <span class="math display">\[
(Y_{i1}, Y_{i2}) \sim \text{MultiNormal}\lp(\mu_1, \mu_2),
\begin{bmatrix}
\sigma^2_1 &amp; \sigma_{12} \\
\sigma_{12} &amp; \sigma_2^2
\end{bmatrix}
\rp
\]</span> We’ll consider the scenario in which <span class="math inline">\(\mu_1, \mu_2\)</span> are the estimands of interest, and Further, suppose that <span class="math inline">\(r\)</span> of those individuals have complete observations, (i.e.&nbsp;<span class="math inline">\(\tilde{y}_{(0)i} = (\tilde{y}_{i1},  \tilde{y}_{i2})\)</span>) and <span class="math inline">\(n-r\)</span> of those individuals have missing values for <span class="math inline">\(Y_{i2}\)</span> (i.e.&nbsp;<span class="math inline">\(\tilde{y}_{(0)i} = (\tilde{y}_{i1})\)</span>).</p>
<p>The parameters of interest are all of the unknown parameters of the multivariate normal distribution. Using only the <span class="math inline">\(r\)</span> complete cases will allow us to estimate the mean of <span class="math inline">\(\mu_1\)</span>. The sample mean, which we’ll denote <span class="math inline">\(\bar{y}^{\mathrm{CC}}_{1}\)</span>, has variance <span class="math inline">\(\sigma_1^2/r\)</span>. We could have used all <span class="math inline">\(n\)</span> observations to estimate the mean, which we’ll call the efficient estimator, or <span class="math inline">\(\bar{y}^\mathrm{eff}_1\)</span> which would instead have variance <span class="math inline">\(\sigma_1^2 / n\)</span>. We can represent the variance of the complete case estimator as a multiple of the variance of the efficient estimator: <span class="math display">\[
\text{Var}\lp \bar{y}^{\mathrm{CC}}_{1}\rp = \text{Var}\lp \bar{y}^{\mathrm{eff}}_{1}\rp(1 + \Delta^\mathrm{CC})
\]</span> In this case, <span class="math inline">\(\Delta^{\mathrm{CC}} = \frac{n - r}{r}\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lecture-2-notes_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For the mean of <span class="math inline">\(Y_{i2}\)</span>, <span class="math inline">\(\mu_2\)</span>, the efficiency loss is: <span class="math display">\[
\Delta^{\mathrm{CC}} \approx \frac{(n-r)\rho^2}{n(1 - \rho^2) + r \rho^2}
\]</span> We’ll prove this later in the class when we work through likelihood theory for incomplete data.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lecture-2-notes_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="bias-of-cca" class="level2">
<h2 class="anchored" data-anchor-id="bias-of-cca">Bias of CCA</h2>
<p>We showed earlier that the bias of the complete case analysis was dependent on the covariance between the missingness indicator and the response; another way to decompose the bias is via the following representation of the sample mean. Recall that <span class="math inline">\(\mathcal{R} = \{i \mid \sum_{j=1}^K \tilde{m}_{ij} = 0, i = 1, \dots, n\}\)</span>; we can define the complement of this set <span class="math inline">\(\mathcal{R}^\comp\)</span>. Then we can represent the sample mean as: <span class="math display">\[
\bar{y} = \frac{r}{n}\bar{y}^\mathrm{CC} + (1 - \frac{r}{n})\bar{y}^{\mathcal{R}^\comp}
\]</span> Note that the sample mean may be unobservable because some units may be missing <span class="math inline">\(y_i\)</span>. Then, conditional on the missingness pattern that was observed, the bias of the</p>
<p><span class="math display">\[
\Exp{\bar{y}^\mathrm{CC} - \bar{y} \mid M = \tilde{m}} = \lp 1 - \frac{r}{n}\rp(\Exp{\bar{y}^\mathrm{CC} \mid M = \tilde{m}} - \Exp{\bar{y}^{\mathcal{R}^\comp} \mid M = \tilde{m}})
\]</span></p>
</section>
</section>
<section id="weighting-estimators" class="level1">
<h1>Weighting estimators</h1>
<p>An alternative to straight CCA is the class of weighting estimators. These estimators are asymptotically unbiased under the assumption of MAR.</p>
<p>The idea behind weighting estimators is similar to weighted estimators used in survey analysis. A weighting estimator you may have encountered before is called the <strong>Horvitz-Thompson</strong> estimator. Suppose we have a populaton of size <span class="math inline">\(N\)</span> and we wish to estimate the mean of some fixed, but unknown, scalar quantity, <span class="math inline">\(Y_i\)</span>. If create a sample of size <span class="math inline">\(n\)</span> from the population with known weights <span class="math inline">\(\pi_i\)</span>, we can compute an unbiased estimator of the mean with <span class="math inline">\(\bar{y}^\mathrm{HT}\)</span>: <span class="math display">\[
\bar{y}^\mathrm{HT} = \frac{1}{N} \sum_{j=1}^n \frac{y_j}{\pi_j}
\]</span> This estimator can be written as a sum over the population of size <span class="math inline">\(N\)</span> with the introduction of an inclusion indicator, <span class="math inline">\(I_i\)</span> which equals <span class="math inline">\(1\)</span> if the <span class="math inline">\(i\)</span> is sampled and <span class="math inline">\(0\)</span> otherwise: <span class="math display">\[
\bar{y}^\mathrm{HT} = \frac{1}{N} \sum_{i=1}^N \frac{y_i I_i}{\pi_i}
\]</span> Treating <span class="math inline">\(y_i\)</span> as fixed unknown quantities and <span class="math inline">\(I_i\)</span> as a random quantity gives the following unbiased estimator for the population average: <span class="math display">\[
\begin{aligned}
\ExpA{\bar{y}^\mathrm{HT}}{I_i} &amp; = \frac{1}{N} \sum_{i=1}^N \ExpA{\frac{y_i I_i}{\pi_i}}{I_i} \\
&amp; = \frac{1}{N} \sum_{i=1}^N \frac{y_i \pi_i}{\pi_i}\\
&amp; = \frac{1}{N} \sum_{i=1}^N y_i
\end{aligned}
\]</span></p>



</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-little2019statistical" class="csl-entry" role="listitem">
Little, Roderick JA, and Donald B Rubin. 2019. <em>Statistical Analysis with Missing Data</em>. John Wiley &amp; Sons.
</div>
<div id="ref-mealliClarifyingMissingRandom2015" class="csl-entry" role="listitem">
Mealli, Fabrizia, and Donald B. Rubin. 2015. <span>“Clarifying Missing at Random and Related Definitions, and Implications When Coupled with Exchangeability: <span>Table</span> 1.”</span> <em>Biometrika</em> 102 (4): 995–1000. <a href="https://doi.org/10.1093/biomet/asv035">https://doi.org/10.1093/biomet/asv035</a>.
</div>
<div id="ref-rubin1995handling" class="csl-entry" role="listitem">
Rubin, Donald B, Hal S Stern, and Vasja Vehovar. 1995. <span>“Handling <span>‘Don’t Know’</span> Survey Responses: The Case of the Slovenian Plebiscite.”</span> <em>Journal of the American Statistical Association</em> 90 (431): 822–28.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>One exception is regression with missing predictors; scenarios in which the predictors have MNAR missingness that doesn’t depend on the outcome can be analyzed with CCA.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>